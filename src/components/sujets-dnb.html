<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sujets DNB Technologie - TechnoLab</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Particules de papier en arri√®re-plan -->
    <div class="paper-particles"></div>

    <!-- Header avec navigation -->
    <header>
        <div class="container">
            <div class="logo">
                <span class="logo-icon">üöÄ</span>
                <h1>TechnoLab</h1>
                <span class="beta-badge">B√äTA</span>
            </div>
            <nav>
                <a href="TechnoLab.html" class="nav-link">üè† Accueil</a>
                <a href="Presentation-TechnoLab.html" class="nav-link">Pr√©sentation</a>
                <a href="sujets-dnb.html" class="nav-link" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white;">üìù Sujets DNB</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-header">
                <h2>üìù Sujets DNB Technologie</h2>
                <p class="hero-subtitle">Tous les sujets du Brevet des Coll√®ges en Technologie</p>
            </div>

            <!-- Statistiques -->
            <div class="stats-bar" id="statsBar" style="display: none;">
                <div class="stat-item">
                    <div class="stat-number" id="totalSubjects">0</div>
                    <div class="stat-label">Sujets disponibles</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="yearRange">-</div>
                    <div class="stat-label">Ann√©es couvertes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalSessions">0</div>
                    <div class="stat-label">Sessions</div>
                </div>
            </div>

            <!-- Filtres -->
            <div class="filter-section" id="filterSection" style="display: none;">
                <span class="filter-label">üîç Filtrer par :</span>
                <select class="filter-select" id="yearFilter">
                    <option value="all">Toutes les ann√©es</option>
                </select>
                <select class="filter-select" id="sessionFilter">
                    <option value="all">Toutes les sessions</option>
                    <option value="M√©tropole">M√©tropole</option>
                    <option value="Am√©rique du Nord">Am√©rique du Nord</option>
                    <option value="Asie-Pacifique">Asie-Pacifique</option>
                    <option value="Centres √©trangers">Centres √©trangers</option>
                    <option value="Polyn√©sie">Polyn√©sie</option>
                </select>
                <select class="filter-select" id="sortFilter">
                    <option value="year-desc">Plus r√©cent d'abord</option>
                    <option value="year-asc">Plus ancien d'abord</option>
                </select>
            </div>

            <!-- √âtat de chargement -->
            <div class="loading-state" id="loadingState">
                <div class="loading-spinner"></div>
                <p>Chargement des sujets...</p>
            </div>

            <!-- √âtat d'erreur -->
            <div class="error-state" id="errorState" style="display: none;">
                <h3>‚ùå Erreur de chargement</h3>
                <p id="errorMessage">Impossible de charger les sujets</p>
            </div>

            <!-- Grille des sujets -->
            <div class="subjects-grid" id="subjectsGrid"></div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>üöÄ TechnoLab - Plateforme d'apprentissage en Technologie | Version B√™ta</p>
            <p>Coll√®ge Moulin √† Vent - Cycle 4 (5√®me, 4√®me, 3√®me)</p>
        </div>
    </footer>

    <script>
        // Configuration - √Ä adapter selon votre structure GitHub
        const GITHUB_CONFIG = {
            owner: 'glbprod',  // Remplacer par votre username GitHub
            repo: 'classeurnumerique',       // Remplacer par le nom de votre repo
            branch: 'main',           // ou 'master' selon votre branche
            folder: '/src/components/sujets-dnb'      // Dossier contenant les sujets
        };

        // Variables globales
        let allSubjects = [];
        let filteredSubjects = [];

        // Fonction pour cr√©er les particules
        function createPaperParticles() {
            const container = document.querySelector('.paper-particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }

        // Fonction pour extraire les informations depuis le nom du fichier
        function parseFileName(filename) {
            // Format attendu: "DNB_2024_Metropole_Sujet.pdf" ou similaire
            const parts = filename.replace('.pdf', '').split('_');
            
            return {
                year: parts[1] || 'Ann√©e inconnue',
                session: parts[2] || 'Session inconnue',
                type: parts[3] || 'Sujet',
                filename: filename
            };
        }

        // Fonction pour charger les sujets depuis GitHub
        async function loadSubjects() {
            const loadingState = document.getElementById('loadingState');
            const errorState = document.getElementById('errorState');
            const subjectsGrid = document.getElementById('subjectsGrid');

            try {
                // URL de l'API GitHub pour lister les fichiers
                const apiUrl = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.folder}?ref=${GITHUB_CONFIG.branch}`;
                
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }

                const files = await response.json();
                
                // Filtrer uniquement les fichiers PDF
                const pdfFiles = files.filter(file => 
                    file.name.toLowerCase().endsWith('.pdf') && file.type === 'file'
                );

                if (pdfFiles.length === 0) {
                    throw new Error('Aucun sujet trouv√© dans le dossier');
                }

                // Parser les informations des fichiers
                allSubjects = pdfFiles.map(file => ({
                    ...parseFileName(file.name),
                    downloadUrl: file.download_url,
                    htmlUrl: file.html_url,
                    size: file.size
                }));

                // Trier par ann√©e d√©croissante par d√©faut
                allSubjects.sort((a, b) => b.year - a.year);
                filteredSubjects = [...allSubjects];

                // Masquer le loading, afficher les sujets
                loadingState.style.display = 'none';
                document.getElementById('statsBar').style.display = 'flex';
                document.getElementById('filterSection').style.display = 'flex';

                // Mettre √† jour les statistiques
                updateStats();

                // Remplir les filtres
                populateFilters();

                // Afficher les sujets
                displaySubjects();

            } catch (error) {
                console.error('Erreur:', error);
                loadingState.style.display = 'none';
                errorState.style.display = 'block';
                document.getElementById('errorMessage').textContent = error.message;
            }
        }

        // Fonction pour mettre √† jour les statistiques
        function updateStats() {
            const years = [...new Set(allSubjects.map(s => s.year))].sort();
            const sessions = new Set(allSubjects.map(s => s.session));

            document.getElementById('totalSubjects').textContent = allSubjects.length;
            document.getElementById('yearRange').textContent = years.length > 0 
                ? `${years[0]} - ${years[years.length - 1]}` 
                : '-';
            document.getElementById('totalSessions').textContent = sessions.size;
        }

        // Fonction pour remplir les filtres d'ann√©es
        function populateFilters() {
            const yearFilter = document.getElementById('yearFilter');
            const years = [...new Set(allSubjects.map(s => s.year))].sort().reverse();

            years.forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearFilter.appendChild(option);
            });
        }

        // Fonction pour afficher les sujets
        function displaySubjects() {
            const grid = document.getElementById('subjectsGrid');
            grid.innerHTML = '';

            if (filteredSubjects.length === 0) {
                grid.innerHTML = '<div class="error-state" style="grid-column: 1/-1;">Aucun sujet ne correspond aux crit√®res de recherche</div>';
                return;
            }

            filteredSubjects.forEach(subject => {
                const card = document.createElement('div');
                card.className = 'subject-card';
                
                card.innerHTML = `
                    <div class="subject-header">
                        <div class="subject-year">${subject.year}</div>
                        <span class="subject-badge">DNB</span>
                    </div>
                    <div class="subject-session">${subject.session}</div>
                    <div class="subject-meta">
                        <span class="meta-tag">üìÑ ${subject.type}</span>
                        <span class="meta-tag">üì¶ ${formatFileSize(subject.size)}</span>
                    </div>
                    <div class="subject-actions">
                        <a href="${subject.downloadUrl}" target="_blank" class="btn-subject" download>
                            ‚¨áÔ∏è T√©l√©charger
                        </a>
                        <a href="${subject.htmlUrl}" target="_blank" class="btn-subject btn-subject-secondary">
                            üëÅÔ∏è Voir
                        </a>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        // Fonction pour formater la taille des fichiers
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        // Fonction de filtrage
        function applyFilters() {
            const yearFilter = document.getElementById('yearFilter').value;
            const sessionFilter = document.getElementById('sessionFilter').value;
            const sortFilter = document.getElementById('sortFilter').value;

            filteredSubjects = allSubjects.filter(subject => {
                const yearMatch = yearFilter === 'all' || subject.year === yearFilter;
                const sessionMatch = sessionFilter === 'all' || subject.session === sessionFilter;
                return yearMatch && sessionMatch;
            });

            // Tri
            if (sortFilter === 'year-desc') {
                filteredSubjects.sort((a, b) => b.year - a.year);
            } else if (sortFilter === 'year-asc') {
                filteredSubjects.sort((a, b) => a.year - b.year);
            }

            displaySubjects();
        }

        // √âcouteurs d'√©v√©nements pour les filtres
        document.getElementById('yearFilter').addEventListener('change', applyFilters);
        document.getElementById('sessionFilter').addEventListener('change', applyFilters);
        document.getElementById('sortFilter').addEventListener('change', applyFilters);

        // Initialisation
        createPaperParticles();
        loadSubjects();
    </script>
</body>
</html>
