<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNB Technologie - Trottinette √âlectrique</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 10px auto;
            padding: 10px;
            background-color: #f5f5f5;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .container {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 6px;
            margin-bottom: 12px;
            font-size: 20px;
        }
        
        h2 {
            color: #34495e;
            margin-top: 15px;
            margin-bottom: 8px;
            background-color: #ecf0f1;
            padding: 6px 8px;
            border-left: 3px solid #3498db;
            font-size: 15px;
        }
        
        .question {
            margin: 12px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .question p {
            margin: 4px 0;
        }
        
        .points {
            color: #e74c3c;
            font-weight: bold;
            font-size: 12px;
        }
        
        input[type="text"], textarea, select {
            width: 100%;
            padding: 5px;
            margin: 3px 0;
            border: 1px solid #bdc3c7;
            border-radius: 3px;
            font-size: 13px;
            font-family: Arial, sans-serif;
        }
        
        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        textarea {
            resize: vertical;
            min-height: 40px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 8px 0;
            font-size: 12px;
        }
        
        th, td {
            border: 1px solid #34495e;
            padding: 6px;
            text-align: left;
        }
        
        th {
            background-color: #34495e;
            color: white;
            font-size: 12px;
        }
        
        input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        
        /* STYLES ALGORIGRAMME COMPACT */
        .flowchart {
            margin: 8px auto;
            padding: 8px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #34495e;
            border-radius: 8px;
        }
        
        .start-end {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #2c3e50;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-size: 22px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .arrow {
            text-align: center;
            font-size: 20px;
            margin: 4px 0;
            color: #2c3e50;
            line-height: 1;
        }
        
        .flowchart-diamond {
            width: 140px;
            height: 140px;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            margin: 15px auto;
            position: relative;
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .diamond-text {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 12px;
            color: white;
            max-width: 100px;
        }
        
        .diamond-input {
            background-color: rgba(255,255,255,0.95);
            border: 1px solid #d68910;
            border-radius: 3px;
            padding: 4px;
            font-size: 12px;
            text-align: center;
            width: 90px;
            font-weight: normal;
        }
        
        .flow-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 10px 0;
            align-items: start;
        }
        
        .flow-branch {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .branch-label {
            font-weight: bold;
            font-size: 13px;
            color: white;
            padding: 5px 15px;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 15px;
            margin-bottom: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .flowchart-box {
            border: 2px solid #2c3e50;
            padding: 8px;
            margin: 8px auto;
            width: 200px;
            min-height: 50px;
            text-align: center;
            background-color: #ecf0f1;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        
        .flowchart-action {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border-color: #2980b9;
        }
        
        .flowchart-box textarea {
            width: 100%;
            border: 1px solid #95a5a6;
            border-radius: 3px;
            padding: 5px;
            font-size: 12px;
            resize: vertical;
            min-height: 35px;
            font-family: Arial, sans-serif;
        }
        
        .flowchart-box textarea:focus {
            outline: none;
            border-color: #3498db;
            background-color: #fff;
        }
        
        .flow-merge {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .merge-symbol {
            width: 0;
            height: 0;
            border-left: 80px solid transparent;
            border-right: 80px solid transparent;
            border-top: 40px solid #2c3e50;
            margin: 8px auto;
        }
        
        .student-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .student-info label {
            font-weight: bold;
            font-size: 13px;
            color: #2c3e50;
            display: block;
            margin-bottom: 3px;
        }
        
        .submit-btn {
            padding: 8px 15px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            color: white;
            font-weight: bold;
            transition: opacity 0.2s;
        }
        
        .submit-btn:hover {
            opacity: 0.9;
        }
        
        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        #result {
            margin-top: 12px;
            padding: 10px;
            display: none;
            background-color: #d4edda;
            border: 2px solid #28a745;
            border-radius: 5px;
        }
        
        #result h3 {
            font-size: 15px;
            margin-bottom: 5px;
        }
        
        #result p {
            font-size: 13px;
        }
        
        /* Styles pour Q5 */
        .matching-exercise {
            margin: 10px 0;
        }
        
        .block-to-place {
            padding: 8px;
            border: 2px solid #34495e;
            border-radius: 5px;
            background-color: #ecf0f1;
            font-size: 12px;
            text-align: center;
        }
        
        .block {
            padding: 4px 8px;
            border-radius: 3px;
            display: inline-block;
            font-weight: 500;
        }
        
        .block-action {
            background-color: #3498db;
            color: white;
        }
        
        .block-condition {
            background-color: #f39c12;
            color: white;
        }
        
        select {
            padding: 4px;
            font-size: 12px;
        }
        
        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
            }
            .submit-btn {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ¥ DNB Technologie - Trottinette √âlectrique</h1>

        <form id="dnbForm">
            <div class="student-info">
                <div>
                    <label for="studentName">Nom et Pr√©nom :</label>
                    <input type="text" id="studentName" name="studentName" required>
                </div>
                <div>
                    <label for="studentClass">Classe :</label>
                    <input type="text" id="studentClass" name="studentClass" required>
                </div>
            </div>

            <!-- QUESTION 1 -->
            <h2>Question 1 <span class="points">(4 points)</span></h2>
            <div class="question">
                <p><strong>Pr√©senter 3 avantages et 1 inconv√©nient d'une trottinette √©lectrique.</strong></p>
                
                <p style="margin-top: 8px;"><strong>Avantage 1 :</strong></p>
                <input type="text" name="q1_avantage1" required>
                
                <p style="margin-top: 6px;"><strong>Avantage 2 :</strong></p>
                <input type="text" name="q1_avantage2" required>
                
                <p style="margin-top: 6px;"><strong>Avantage 3 :</strong></p>
                <input type="text" name="q1_avantage3" required>
                
                <p style="margin-top: 6px;"><strong>Inconv√©nient :</strong></p>
                <input type="text" name="q1_inconvenient" required>
            </div>

            <!-- QUESTION 2 -->
            <h2>Question 2 <span class="points">(7 points)</span></h2>
            <div class="question">
                <p><strong>√Ä partir de l'analyse du besoin, compl√©ter le tableau de description des fonctions de service.</strong></p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Fonction de service</th>
                            <th>Crit√®re d'appr√©ciation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Avertir</strong></td>
                            <td><input type="text" name="q2_avertir" placeholder="" required></td>
                        </tr>
                        <tr>
                            <td rowspan="3"><strong>Avancer</strong></td>
                            <td><input type="text" name="q2_avancer1" placeholder="" required></td>
                        </tr>
                        <tr>
                            <td><input type="text" name="q2_avancer2" placeholder="" required></td>
                        </tr>
                        <tr>
                            <td><input type="text" name="q2_avancer3" placeholder="" required></td>
                        </tr>
                        <tr>
                            <td rowspan="2"><strong>√âclairer</strong></td>
                            <td><input type="text" name="q2_eclairer1" placeholder="" required></td>
                        </tr>
                        <tr>
                            <td><input type="text" name="q2_eclairer2" placeholder="" required></td>
                        </tr>
                    </tbody>
                </table>
                
                <p style="margin-top: 10px;"><strong>Quelle est la fonction contrainte de la batterie ?</strong></p>
                <input type="text" name="q2_fonction_batterie" placeholder="" required>
            </div>

            <!-- QUESTION 3 -->
            <h2>Question 3 <span class="points">(4 points)</span></h2>
            <div class="question">
                <p><strong>En vous aidant des documents ressources, cocher les solutions techniques utilis√©es pour r√©aliser les fonctions techniques de la trottinette √©lectrique.</strong></p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Fonction technique</th>
                            <th>Solution technique</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Freiner</td>
                            <td><input type="checkbox" name="q3_freiner"> Frein √† disque</td>
                        </tr>
                        <tr>
                            <td>Avertir</td>
                            <td><input type="checkbox" name="q3_avertir"> Sonnette √©lectronique</td>
                        </tr>
                        <tr>
                            <td>Avancer</td>
                            <td><input type="checkbox" name="q3_avancer"> Moteur √©lectrique</td>
                        </tr>
                        <tr>
                            <td>√âclairer</td>
                            <td><input type="checkbox" name="q3_eclairer"> √âclairage LED</td>
                        </tr>
                        <tr>
                            <td>Stocker l'√©nergie</td>
                            <td><input type="checkbox" name="q3_batterie"> Batterie lithium-ion</td>
                        </tr>
                        <tr>
                            <td>Mesurer la vitesse</td>
                            <td><input type="checkbox" name="q3_vitesse"> Capteur de vitesse</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- QUESTION 4 -->
            <h2>Question 4 <span class="points">(6 points)</span></h2>
            <div class="question">
                <p><strong>Compl√©ter l'algorigramme suivant qui repr√©sente le fonctionnement de la commande d'acc√©l√©ration de la trottinette.</strong></p>
                
                <div class="flowchart">
                    <div class="start-end">‚¨§</div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="flowchart-box">
                        <textarea name="q4_box1" rows="2" placeholder="" required></textarea>
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="flowchart-box">
                        <textarea name="q4_box2" rows="2" placeholder="" required></textarea>
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="flowchart-diamond">
                        <div class="diamond-text">
                            La g√¢chette d'acc√©l√©ration est-elle actionn√©e ?
                            <input type="text" name="q4_diamond" class="diamond-input" placeholder="" required>
                        </div>
                    </div>
                    
                    <div class="flow-split">
                        <div class="flow-branch">
                            <div class="branch-label">OUI</div>
                            <div class="arrow">‚Üì</div>
                            <div class="flowchart-box flowchart-action">
                                <textarea name="q4_reponse1" rows="2" placeholder="" required></textarea>
                            </div>
                        </div>
                        
                        <div class="flow-branch">
                            <div class="branch-label">NON</div>
                            <div class="arrow">‚Üì</div>
                            <div class="flowchart-box flowchart-action">
                                <textarea name="q4_reponse2" rows="2" placeholder="" required></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flow-merge">
                        <div class="merge-symbol"></div>
                    </div>
                    
                    <div class="flowchart-box">
                        Continuer √† rouler
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="start-end">‚¨§</div>
                </div>
            </div>

            <!-- QUESTION 5 -->
            <h2>Question 5 <span class="points">(4 points)</span></h2>
            <div class="question">
                <p><strong>Placer les blocs suivants dans l'algorigramme de l'√©cran de contr√¥le (indiquez A, B, C ou D).</strong></p>
                
                <div class="matching-exercise">
                    <table>
                        <thead>
                            <tr>
                                <th>Bloc √† placer</th>
                                <th>Position dans l'algorigramme</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="block-to-place">
                                        <span class="block block-action">Autoriser l'acc√©l√©ration</span>
                                    </div>
                                </td>
                                <td>
                                    <select name="q5_autoriser" required>
                                        <option value="">-- Choisir --</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="block-to-place">
                                        <span class="block block-condition">G√¢chette actionn√©e ?</span>
                                    </div>
                                </td>
                                <td>
                                    <select name="q5_gachette" required>
                                        <option value="">-- Choisir --</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="block-to-place">
                                        <span class="block block-condition">Bouton ON appuy√© ?</span>
                                    </div>
                                </td>
                                <td>
                                    <select name="q5_bouton" required>
                                        <option value="">-- Choisir --</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="block-to-place">
                                        <span class="block block-action">Ne pas autoriser l'acc√©l√©ration</span>
                                    </div>
                                </td>
                                <td>
                                    <select name="q5_ne_pas_autoriser" required>
                                        <option value="">-- Choisir --</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button type="button" id="sendToFirebase" class="submit-btn" style="background-color: #27ae60; flex: 1;">
                    üì§ Envoyer
                </button>
                <button type="reset" class="submit-btn" style="background-color: #e74c3c; flex: 0.3;">
                    üîÑ Effacer
                </button>
            </div>
        </form>

        <div id="result">
            <h3>‚úÖ R√©ponses enregistr√©es !</h3>
            <p>Vos r√©ponses ont √©t√© sauvegard√©es.</p>
        </div>
    </div>

    <script>
        // Protection par mot de passe
        (function() {
            const MOT_DE_PASSE = 'dnb';
            let tentatives = 3;
            
            while (tentatives > 0) {
                const saisie = prompt('üîí Mot de passe requis pour acc√©der au formulaire :');
                
                if (saisie === null) {
                    document.body.innerHTML = '<h1 style="text-align:center;margin-top:50px;">‚ùå Acc√®s annul√©</h1>';
                    throw new Error('Acc√®s annul√©');
                }
                
                if (saisie === MOT_DE_PASSE) {
                    return;
                }
                
                tentatives--;
                if (tentatives > 0) {
                    alert('‚ùå Mot de passe incorrect ! Il vous reste ' + tentatives + ' tentative(s).');
                }
            }
            
            alert('üö´ Nombre de tentatives d√©pass√© !');
            document.body.innerHTML = '<h1 style="text-align:center;margin-top:50px;">‚ùå Acc√®s refus√©</h1>';
            throw new Error('Acc√®s refus√©');
        })();
        
        // Confirmation avant fermeture
        let formModified = false;

        document.getElementById('dnbForm').addEventListener('input', function() {
            formModified = true;
        });

        window.addEventListener('beforeunload', function(e) {
            if (formModified) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            }
        });
           
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDIvzEk0xKVdRC0r9D_tBGnKPX29Fqkem4",
            authDomain: "form-results-b285b.firebaseapp.com",
            projectId: "form-results-b285b",
            storageBucket: "form-results-b285b.firebasestorage.app",
            messagingSenderId: "662462446647",
            appId: "1:662462446647:web:0fe6315cc0c189185513b2"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Bouton d'envoi
        document.getElementById('sendToFirebase').addEventListener('click', async function() {
            const form = document.getElementById('dnbForm');
            
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const originalText = this.textContent;
            this.disabled = true;
            this.textContent = '‚è≥ Envoi...';
            
            try {
                const formData = new FormData(form);
                
                const responses = {
                    nom_eleve: document.getElementById('studentName').value,
                    classe: document.getElementById('studentClass').value,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    date_soumission: new Date().toISOString(),
                    
                    q1_avantage1: formData.get('q1_avantage1') || '',
                    q1_avantage2: formData.get('q1_avantage2') || '',
                    q1_avantage3: formData.get('q1_avantage3') || '',
                    q1_inconvenient: formData.get('q1_inconvenient') || '',
                    
                    q2_avertir: formData.get('q2_avertir') || '',
                    q2_avancer1: formData.get('q2_avancer1') || '',
                    q2_avancer2: formData.get('q2_avancer2') || '',
                    q2_avancer3: formData.get('q2_avancer3') || '',
                    q2_eclairer1: formData.get('q2_eclairer1') || '',
                    q2_eclairer2: formData.get('q2_eclairer2') || '',
                    q2_fonction_batterie: formData.get('q2_fonction_batterie') || '',
                    
                    q3_freiner: formData.get('q3_freiner') === 'on',
                    q3_avertir: formData.get('q3_avertir') === 'on',
                    q3_avancer: formData.get('q3_avancer') === 'on',
                    q3_eclairer: formData.get('q3_eclairer') === 'on',
                    q3_batterie: formData.get('q3_batterie') === 'on',
                    q3_vitesse: formData.get('q3_vitesse') === 'on',
                    
                    q4_box1: formData.get('q4_box1') || '',
                    q4_box2: formData.get('q4_box2') || '',
                    q4_box3: formData.get('q4_box3') || '',
                    q4_diamond: formData.get('q4_diamond') || '',
                    q4_reponse1: formData.get('q4_reponse1') || '',
                    q4_reponse2: formData.get('q4_reponse2') || '',
                    
                    q5_autoriser: formData.get('q5_autoriser') || '',
                    q5_gachette: formData.get('q5_gachette') || '',
                    q5_bouton: formData.get('q5_bouton') || '',
                    q5_ne_pas_autoriser: formData.get('q5_ne_pas_autoriser') || ''
                };
                
                const docRef = await db.collection('dnb_trottinette').add(responses);
                
                this.disabled = false;
                this.textContent = originalText;
                
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
                
                setTimeout(() => {
                    form.reset();
                    formModified = false;
                    document.getElementById('result').style.display = 'none';
                }, 3000);
                
            } catch (error) {
                console.error('‚ùå Erreur Firebase:', error);
                this.disabled = false;
                this.textContent = originalText;
                alert('‚ùå Erreur lors de l\'envoi : ' + error.message);
            }
        });

        document.getElementById('dnbForm').addEventListener('reset', function(e) {
            if (!confirm('√ätes-vous s√ªr de vouloir effacer toutes vos r√©ponses ?')) {
                e.preventDefault();
            } else {
                formModified = false;
                document.getElementById('result').style.display = 'none';
            }
        });
    </script>
</body>
</html>
