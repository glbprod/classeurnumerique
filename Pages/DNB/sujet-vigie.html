<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNB Technologie - Vigie de Surveillance</title>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #e74c3c;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            background-color: #ecf0f1;
            padding: 10px;
            border-left: 4px solid #e74c3c;
        }
        .question {
            margin: 25px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .points {
            color: #e74c3c;
            font-weight: bold;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 2px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #e74c3c;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 2px solid #34495e;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #34495e;
            color: white;
        }
        td input[type="text"], td select {
            border: 1px solid #95a5a6;
            width: 100%;
        }
        .submit-btn {
            background-color: #27ae60;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }
        .submit-btn:hover {
            background-color: #229954;
        }
        .intro {
            background-color: #fff5f5;
            padding: 15px;
            border-left: 4px solid #e74c3c;
            margin-bottom: 20px;
        }
        .doc-box {
            background-color: #e8f4f8;
            padding: 15px;
            margin: 15px 0;
            border: 2px dashed #3498db;
            text-align: center;
        }
        .solution-box {
            display: inline-block;
            border: 2px solid #e74c3c;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            text-align: center;
            line-height: 40px;
            font-weight: bold;
            margin: 5px;
            background-color: white;
        }
        .solutions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .solution-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .binary-input {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin: 10px 0;
        }
        .binary-input input {
            width: 40px;
            height: 40px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            border: 2px solid #34495e;
        }
        .binary-label {
            font-size: 12px;
            text-align: center;
            color: #7f8c8d;
        }
        .radio-group {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .radio-group input[type="radio"] {
            width: 20px;
            height: 20px;
        }
        .program-block {
            background-color: #fff;
            border: 2px solid #34495e;
            padding: 20px;
            margin: 15px 0;
        }
        .program-line {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-left: 3px solid #e74c3c;
        }
        select {
            padding: 8px;
            border: 2px solid #bdc3c7;
            border-radius: 4px;
            font-size: 14px;
        }
        .calc-zone {
            background-color: #fff;
            padding: 15px;
            border: 2px solid #3498db;
            border-radius: 5px;
            margin: 10px 0;
        }
        .formula {
            background-color: #e8f4f8;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• DNB Technologie - Vigie de Surveillance</h1>
        <p style="text-align: right; font-style: italic;">Dur√©e conseill√©e : 30 minutes - 25 points</p>

        <div class="intro">
            <p><strong>Contexte :</strong> En 2022, les feux de for√™t ont d√©truit 62 000 hectares en France. Pour lutter contre les incendies, les for√™ts sont surveill√©es depuis des postes appel√©s vigies.</p>
            <p>Depuis une vigie, les pompiers ont une vue d√©gag√©e √† 360 degr√©s et peuvent localiser des d√©parts de feu sur une distance de plus de 20 km.</p>
            <p>Le syst√®me automatis√© de surveillance install√© sur le toit de la vigie est constitu√© de deux appareils photo.</p>
        </div>

        <div class="doc-box">
            <figure style="margin: 0; padding: 10px;">
                <img src="https://latechnologieaucollege.netlify.app/Pages/DNB/img/vigie.png" 
                     alt="Sch√©ma de la vigie avec dimensions et composants"
                     style="max-width: 100%; height: auto;">
                <figcaption style="margin-top: 10px; color: #7f8c8d;">
                    Document 1 : Vigie et son syst√®me automatis√© de surveillance
                </figcaption>
            </figure>
        </div>
        
        <form id="dnbForm">
            <!-- Identification de l'√©l√®ve -->
            <div class="question" style="background-color: #fff3cd; border-left: 4px solid #ffc107;">
                <p><strong>Nom et Pr√©nom :</strong></p>
                <input type="text" id="studentName" name="studentName" placeholder="Ex: Dupont Marie" required>
                
                <p style="margin-top: 15px;"><strong>Classe :</strong></p>
                <input type="text" id="studentClass" name="studentClass" placeholder="Ex: 3√®meA" required>
            </div>

            <!-- Question 1 -->
            <div class="question">
                <h2>Question 1 <span class="points">(5 points)</span></h2>
                <p><strong>Identifier le besoin auquel r√©pond la vigie :</strong></p>
                <textarea name="q1_besoin" rows="3" placeholder="D√©crivez le besoin..." required></textarea>

                <p style="margin-top: 20px;"><strong>Associer les solutions techniques aux fonctions techniques (6 r√©ponses attendues) :</strong></p>
                
                <div class="doc-box">
                    <p style="color: #7f8c8d; font-style: italic;">[Ins√©rer ici le diagramme des fonctions]</p>
                </div>

                <div class="solutions-grid">
                    <div class="solution-item">
                        <span class="solution-box">1</span>
                        <span>Volets pliants</span>
                    </div>
                    <div class="solution-item">
                        <span class="solution-box">2</span>
                        <span>Appareil photo 1</span>
                    </div>
                    <div class="solution-item">
                        <span class="solution-box">3</span>
                        <span>Isolation laine de bois</span>
                    </div>
                    <div class="solution-item">
                        <span class="solution-box">4</span>
                        <span>Panneau photovolta√Øque et batterie</span>
                    </div>
                    <div class="solution-item">
                        <span class="solution-box">5</span>
                        <span>Appareil photo 2</span>
                    </div>
                    <div class="solution-item">
                        <span class="solution-box">6</span>
                        <span>Ventilation</span>
                    </div>
                    <div class="solution-item">
                        <span class="solution-box">7</span>
                        <span>Structure m√©tallique acier</span>
                    </div>
                </div>

                <table style="margin-top: 20px;">
                    <thead>
                        <tr>
                            <th>Fonction</th>
                            <th>N¬∞ Solution(s)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>E1 - Sur√©lever le b√¢timent tout en r√©sistant aux vents</strong></td>
                            <td>
                                <input type="text" name="q1_e1" placeholder="N¬∞" style="width: 60px;">
                            </td>
                        </tr>
                        <tr>
                            <td><strong>E2 - √âviter les intrusions</strong></td>
                            <td>
                                <input type="text" name="q1_e2" placeholder="N¬∞" style="width: 60px;">
                            </td>
                        </tr>
                        <tr>
                            <td><strong>E3 - Assurer le confort des pompiers malgr√© les contraintes climatiques</strong></td>
                            <td>
                                <input type="text" name="q1_e3" placeholder="N¬∞" style="width: 60px;">
                            </td>
                        </tr>
                        <tr>
                            <td><strong>E4 - Permettre une surveillance automatique</strong></td>
                            <td>
                                <input type="text" name="q1_e4" placeholder="N¬∞ (s√©par√©s par des virgules)" style="width: 150px;">
                            </td>
                        </tr>
                        <tr>
                            <td><strong>E5 - √ätre autonome en √©nergie</strong></td>
                            <td>
                                <input type="text" name="q1_e5" placeholder="N¬∞" style="width: 60px;">
                            </td>
                        </tr>
                        <tr>
                            <td><strong>E6 - S'int√©grer dans le paysage</strong></td>
                            <td>
                                <input type="text" name="q1_e6" placeholder="N¬∞" style="width: 60px;">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Question 2 -->
            <div class="question">
                <h2>Question 2 <span class="points">(4 points)</span></h2>
                
                <div class="doc-box">
                    <p><strong>Document 2 : √âtude du cycle de mouvement de l'appareil photo 1</strong></p>
                    <p style="color: #7f8c8d; font-style: italic;">[Ins√©rer ici le sch√©ma et le graphique du cycle]</p>
                </div>

                <p><strong>Nature du mouvement de l'appareil photo 1 :</strong></p>
                <input type="text" name="q2_nature" placeholder="Type de mouvement..." required>

                <p style="margin-top: 15px;"><strong>Pour la position 6 (60¬∞), d√©terminer le temps √©coul√© entre deux prises de vue :</strong></p>
                <textarea name="q2_temps" rows="3" placeholder="Calculs et r√©sultat..." required></textarea>
            </div>

            <!-- Question 3 -->
            <div class="question">
                <h2>Question 3 <span class="points">(6 points)</span></h2>
                
                <div class="doc-box">
                    <p><strong>Document 3 : Pr√©sentation de la gestion de l'√©nergie du syst√®me</strong></p>
                    <p style="color: #7f8c8d; font-style: italic;">[Ins√©rer ici le sch√©ma de gestion d'√©nergie]</p>
                </div>

                <p><strong>Calculer la capacit√© de la batterie pour assurer une autonomie √©nerg√©tique du syst√®me pendant 12 heures, sans apport solaire :</strong></p>
                
                <div class="calc-zone">
                    <p><strong>Donn√©es :</strong></p>
                    <ul>
                        <li>Intensit√© par appareil photo : 0,7 A</li>
                        <li>Intensit√© par moteur : 0,5 A</li>
                        <li>Nombre d'appareils photo : 2</li>
                        <li>Nombre de moteurs : 2</li>
                        <li>Autonomie souhait√©e : 12 heures</li>
                    </ul>
                    
                    <div class="formula">
                        <strong>Formule : Q = I √ó t</strong><br>
                        Q : capacit√© de la batterie en A¬∑h (Amp√®re √ó heure)<br>
                        I : intensit√© moyenne consomm√©e par le syst√®me en A (Amp√®re)<br>
                        t : dur√©e d'utilisation du syst√®me en h (heure)
                    </div>
                </div>

                <p><strong>D√©tails des calculs :</strong></p>
                <textarea name="q3_calculs" rows="6" placeholder="√âcrivez vos calculs d√©taill√©s ici...&#10;Exemple:&#10;- Intensit√© totale = ...&#10;- Capacit√© Q = I √ó t = ..." required></textarea>

                <p style="margin-top: 10px;"><strong>R√©sultat final :</strong></p>
                <input type="text" name="q3_resultat" placeholder="Q = ... A¬∑h" required>
            </div>

            <!-- Question 4 -->
            <div class="question">
                <h2>Question 4 <span class="points">(5 points)</span></h2>
                
                <div class="doc-box">
                    <p><strong>Document 4 : D√©tection d'une anomalie par comparaison d'images</strong></p>
                    <p style="color: #7f8c8d; font-style: italic;">[Ins√©rer ici les images A et B avec les pixels]</p>
                </div>

                <div class="doc-box">
                    <p><strong>Document 5 : Tableau de correspondance</strong></p>
                    <p style="color: #7f8c8d; font-style: italic;">[Ins√©rer ici le tableau de correspondance binaire/d√©cimal]</p>
                </div>

                <p><strong>Valeur en √©criture binaire du pixel P pour le cycle 2 :</strong></p>
                <div class="binary-input">
                    <div>
                        <input type="text" name="q4_b8" maxlength="1" pattern="[0-1]" required>
                        <div class="binary-label">b8</div>
                    </div>
                    <div>
                        <input type="text" name="q4_b7" maxlength="1" pattern="[0-1]" required>
                        <div class="binary-label">b7</div>
                    </div>
                    <div>
                        <input type="text" name="q4_b6" maxlength="1" pattern="[0-1]" required>
                        <div class="binary-label">b6</div>
                    </div>
                    <div>
                        <input type="text" name="q4_b5" maxlength="1" pattern="[0-1]" required>
                        <div class="binary-label">b5</div>
                    </div>
                    <div>
                        <input type="text" name="q4_b4" maxlength="1" pattern="[0-1]" required>
                        <div class="binary-label">b4</div>
                    </div>
                    <div>
                        <input type="text" name="q4_b3" maxlength="1" pattern="[0-1]" required>
                        <div class="binary-label">b3</div>
                    </div>
                    <div>
                        <input type="text" name="q4_b2" maxlength="1" pattern="[0-1]" required>
                        <div class="binary-label">b2</div>
                    </div>
                    <div>
                        <input type="text" name="q4_b1" maxlength="1" pattern="[0-1]" required>
                        <div class="binary-label">b1</div>
                    </div>
                </div>

                <p style="margin-top: 20px;"><strong>Valeur en √©criture d√©cimale du pixel P pour le cycle 1 :</strong></p>
                <input type="number" name="q4_decimal_c1" placeholder="Valeur d√©cimale" required>

                <p style="margin-top: 15px;"><strong>Valeur en √©criture d√©cimale du pixel P pour le cycle 2 :</strong></p>
                <input type="number" name="q4_decimal_c2" placeholder="Valeur d√©cimale" required>

                <p style="margin-top: 20px;"><strong>Une alerte est-elle donn√©e suite √† la comparaison des images A et B ?</strong></p>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="q4_alerte" value="oui" required> Oui
                    </label>
                    <label>
                        <input type="radio" name="q4_alerte" value="non" required> Non
                    </label>
                </div>

                <p style="margin-top: 10px;"><strong>Argumentation :</strong></p>
                <textarea name="q4_argumentation" rows="3" placeholder="Justifiez votre r√©ponse (rappel : une alerte est d√©clench√©e si la variation est sup√©rieure √† 50)..." required></textarea>
            </div>

            <!-- Question 5 -->
            <div class="question">
                <h2>Question 5 <span class="points">(5 points)</span></h2>
                
                <div class="doc-box">
                    <p style="color: #7f8c8d; font-style: italic;">[Ins√©rer ici l'image du programme √† compl√©ter]</p>
                </div>

                <p><strong>Compl√©ter le programme (5 √©l√©ments attendus) :</strong></p>
                
                <div class="program-block">
                    <div class="program-line">
                        <strong>1. Mettre "angle app. photo" √† :</strong>
                        <input type="text" name="q5_element1" placeholder="Compl√©tez..." required>
                    </div>

                    <div class="program-line">
                        <strong>2. Mettre "d√©tection anomalie" √† :</strong>
                        <input type="text" name="q5_element2" placeholder="Compl√©tez..." required>
                    </div>

                    <div class="program-line">
                        <strong>3. R√©p√©ter jusqu'√† ce que "angle app. photo" = :</strong>
                        <input type="text" name="q5_element3" placeholder="Compl√©tez..." required>
                    </div>

                    <div class="program-line">
                        <strong>4. Ajouter _______ √† "angle app. photo" :</strong>
                        <input type="text" name="q5_element4" placeholder="Compl√©tez..." required>
                    </div>

                    <div class="program-line">
                        <strong>5. Si "d√©tection anomalie" = :</strong>
                        <input type="text" name="q5_element5" placeholder="Compl√©tez..." required>
                    </div>
                </div>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button type="button" id="sendToFirebase" class="submit-btn" style="background-color: #27ae60; flex: 1;">
                    üì§ Envoyer mes r√©ponses
                </button>
                <button type="reset" class="submit-btn" style="background-color: #e74c3c; flex: 0.3;">
                    üîÑ R√©initialiser
                </button>
            </div>
        </form>

        <div id="result" style="margin-top: 20px; padding: 15px; display: none; background-color: #d4edda; border: 2px solid #28a745; border-radius: 5px;">
            <h3>‚úÖ R√©ponses enregistr√©es !</h3>
            <p>Vos r√©ponses ont √©t√© sauvegard√©es. Vous pouvez maintenant les relire ou demander une correction √† votre professeur.</p>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIRMATION AVANT FERMETURE
        // ============================================
        let formModified = false;

        document.getElementById('dnbForm').addEventListener('input', function() {
            formModified = true;
        });

        window.addEventListener('beforeunload', function(e) {
            if (formModified) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            }
        });

      // // Protection par mot de passe
      // (function() {
      //     const MOT_DE_PASSE = '2rv3eb95'; // ‚Üê Changez ici
      //     let tentatives = 3;
          
      //     while (tentatives > 0) {
      //         const saisie = prompt('üîí Mot de passe requis pour acc√©der au formulaire :');
              
      //         if (saisie === null) {
      //             document.body.innerHTML = '<h1 style="text-align:center;margin-top:50px;">‚ùå Acc√®s annul√©</h1>';
      //             throw new Error('Acc√®s annul√©');
      //         }
              
      //         if (saisie === MOT_DE_PASSE) {
      //             return; // ‚úÖ Mot de passe correct
      //         }
              
      //         tentatives--;
      //         if (tentatives > 0) {
      //             alert('‚ùå Mot de passe incorrect ! Il vous reste ' + tentatives + ' tentative(s).');
      //         }
      //     }
          
      //     alert('üö´ Nombre de tentatives d√©pass√© !');
      //     document.body.innerHTML = '<h1 style="text-align:center;margin-top:50px;">‚ùå Acc√®s refus√©</h1>';
      //     throw new Error('Acc√®s refus√©');
      // })();
           
        // ============================================
        // CONFIGURATION FIREBASE
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyDIvzEk0xKVdRC0r9D_tBGnKPX29Fqkem4",
            authDomain: "form-results-b285b.firebaseapp.com",
            projectId: "form-results-b285b",
            storageBucket: "form-results-b285b.firebasestorage.app",
            messagingSenderId: "662462446647",
            appId: "1:662462446647:web:0fe6315cc0c189185513b2"
        };

        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        console.log('‚úÖ Firebase initialis√©');

        // ============================================
        // BOUTON D'ENVOI
        // ============================================
        document.getElementById('sendToFirebase').addEventListener('click', async function() {
            const form = document.getElementById('dnbForm');
            
            // V√©rifier la validit√© du formulaire
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            // D√©sactiver le bouton
            const originalText = this.textContent;
            this.disabled = true;
            this.textContent = '‚è≥ Envoi en cours...';
            
            try {
                // Collecter les donn√©es
                const formData = new FormData(form);
                
                // Construire la valeur binaire compl√®te
                const binaryValue = 
                    (formData.get('q4_b8') || '') +
                    (formData.get('q4_b7') || '') +
                    (formData.get('q4_b6') || '') +
                    (formData.get('q4_b5') || '') +
                    (formData.get('q4_b4') || '') +
                    (formData.get('q4_b3') || '') +
                    (formData.get('q4_b2') || '') +
                    (formData.get('q4_b1') || '');
                
                const responses = {
                    nom_eleve: document.getElementById('studentName').value,
                    classe: document.getElementById('studentClass').value,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    date_soumission: new Date().toISOString(),
                    
                    // Question 1 (5 points)
                    q1_besoin: formData.get('q1_besoin') || '',
                    q1_e1: formData.get('q1_e1') || '',
                    q1_e2: formData.get('q1_e2') || '',
                    q1_e3: formData.get('q1_e3') || '',
                    q1_e4: formData.get('q1_e4') || '',
                    q1_e5: formData.get('q1_e5') || '',
                    q1_e6: formData.get('q1_e6') || '',
                    
                    // Question 2 (4 points)
                    q2_nature: formData.get('q2_nature') || '',
                    q2_temps: formData.get('q2_temps') || '',
                    
                    // Question 3 (6 points)
                    q3_calculs: formData.get('q3_calculs') || '',
                    q3_resultat: formData.get('q3_resultat') || '',
                    
                    // Question 4 (5 points)
                    q4_binaire_complet: binaryValue,
                    q4_b8: formData.get('q4_b8') || '',
                    q4_b7: formData.get('q4_b7') || '',
                    q4_b6: formData.get('q4_b6') || '',
                    q4_b5: formData.get('q4_b5') || '',
                    q4_b4: formData.get('q4_b4') || '',
                    q4_b3: formData.get('q4_b3') || '',
                    q4_b2: formData.get('q4_b2') || '',
                    q4_b1: formData.get('q4_b1') || '',
                    q4_decimal_c1: formData.get('q4_decimal_c1') || '',
                    q4_decimal_c2: formData.get('q4_decimal_c2') || '',
                    q4_alerte: formData.get('q4_alerte') || '',
                    q4_argumentation: formData.get('q4_argumentation') || '',
                    
                    // Question 5 (5 points)
                    q5_element1: formData.get('q5_element1') || '',
                    q5_element2: formData.get('q5_element2') || '',
                    q5_element3: formData.get('q5_element3') || '',
                    q5_element4: formData.get('q5_element4') || '',
                    q5_element5: formData.get('q5_element5') || ''
                };
                
                console.log('üì§ Envoi des donn√©es:', responses);
                
                // Envoyer √† Firebase
                const docRef = await db.collection('dnb_vigie').add(responses);
                
                console.log('‚úÖ Document enregistr√© avec ID:', docRef.id);
                
                // R√©activer le bouton
                this.disabled = false;
                this.textContent = originalText;
                
                // Notification de succ√®s
                document.getElementById('result').style.display = 'block';
                document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
                
                // R√©initialiser le formulaire apr√®s 3 secondes
                setTimeout(() => {
                    form.reset();
                    formModified = false;
                    document.getElementById('result').style.display = 'none';
                }, 3000);
                
            } catch (error) {
                console.error('‚ùå Erreur Firebase:', error);
                
                // R√©activer le bouton
                this.disabled = false;
                this.textContent = originalText;
                
                // Notification d'erreur
                alert('‚ùå Erreur lors de l\'envoi : ' + error.message);
            }
        });

        // Gestion du bouton de r√©initialisation
        document.getElementById('dnbForm').addEventListener('reset', function() {
            if (confirm('√ätes-vous s√ªr de vouloir effacer toutes vos r√©ponses ?')) {
                formModified = false;
                document.getElementById('result').style.display = 'none';
            } else {
                return false;
            }
        });

        // Auto-focus sur le prochain champ binaire
        const binaryInputs = document.querySelectorAll('.binary-input input');
        binaryInputs.forEach((input, index) => {
            input.addEventListener('input', function() {
                if (this.value.length === 1 && index < binaryInputs.length - 1) {
                    binaryInputs[index + 1].focus();
                }
            });
        });
    </script>
</body>
</html>
