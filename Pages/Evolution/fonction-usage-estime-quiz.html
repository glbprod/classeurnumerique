<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exercices - Fonction d'usage et Fonction d'estime</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }
        .exercise {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 25px 0;
            border-radius: 8px;
        }
        .exercise h2 {
            color: #764ba2;
            margin-top: 0;
            font-size: 1.3em;
        }
        .question {
            margin: 15px 0;
        }
        .question label {
            display: block;
            margin: 8px 0;
            padding: 10px;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .question label:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        input[type="radio"], input[type="checkbox"] {
            margin-right: 10px;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
            box-sizing: border-box;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .student-info {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        .student-info input {
            margin-bottom: 10px;
        }
        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.3s, box-shadow 0.3s;
            flex: 1;
            min-width: 200px;
        }
        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-sheets {
            background: linear-gradient(135deg, #34a853 0%, #0f9d58 100%);
        }
        .btn-sheets:hover:not(:disabled) {
            box-shadow: 0 5px 20px rgba(52, 168, 83, 0.4);
        }
        .btn-json {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .info-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .info-box strong {
            color: #856404;
        }
        .definition {
            background: #d1ecf1;
            border-left: 4px solid #0c5460;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .definition strong {
            color: #0c5460;
        }
        .config-box {
            background: #ffe6e6;
            border: 2px solid #ff4444;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .config-box strong {
            color: #cc0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Fonction d'usage et Fonction d'estime</h1>
        <p class="subtitle">Niveau 5√®me - Technologie</p>

        <div class="info-box">
            <strong>Instructions :</strong> Compl√®te les trois exercices ci-dessous. Tu peux ensuite choisir d'envoyer tes r√©ponses ou de les t√©l√©charger.
        </div>

        <div class="definition">
            <strong>üìñ Rappel :</strong><br>
            ‚Ä¢ <strong>Fonction d'usage</strong> : le service rendu par l'objet technique. On la trouve en r√©pondant √† la question "√Ä quoi sert cet objet ?"<br>
            ‚Ä¢ <strong>Fonction d'estime</strong> : li√©e aux go√ªts des utilisateurs et peut √™tre ressentie diff√©remment d'une personne √† l'autre.
        </div>

        <form id="quizForm">
            <div class="student-info">
                <h3>üë§ Informations √©l√®ve</h3>
                <input type="text" id="studentName" placeholder="Pr√©nom et Nom" required>
                <input type="text" id="studentClass" placeholder="Classe (ex: 5√®me3)" required>
            </div>

            <!-- Exercice 1 -->
            <div class="exercise">
                <h2>Exercice 1 : Identifier la fonction d'usage</h2>
                <p>Pour chaque objet technique, identifie sa fonction d'usage principale :</p>
                
                <div class="question">
                    <p><strong>1.1 - Un v√©lo :</strong></p>
                    <label><input type="radio" name="q1_1" value="deplacement" required> Permettre de se d√©placer</label>
                    <label><input type="radio" name="q1_1" value="sport"> Faire du sport</label>
                    <label><input type="radio" name="q1_1" value="decoration"> D√©corer un espace</label>
                    <label><input type="radio" name="q1_1" value="communiquer"> Communiquer</label>
                </div>

                <div class="question">
                    <p><strong>1.2 - Un smartphone :</strong></p>
                    <label><input type="radio" name="q1_2" value="eclairer" required> √âclairer</label>
                    <label><input type="radio" name="q1_2" value="communiquer"> Communiquer et acc√©der √† l'information</label>
                    <label><input type="radio" name="q1_2" value="chauffer"> Chauffer</label>
                    <label><input type="radio" name="q1_2" value="ranger"> Ranger des objets</label>
                </div>

                <div class="question">
                    <p><strong>1.3 - Un r√©frig√©rateur :</strong></p>
                    <label><input type="radio" name="q1_3" value="eclairer" required> √âclairer la cuisine</label>
                    <label><input type="radio" name="q1_3" value="conserver"> Conserver les aliments au frais</label>
                    <label><input type="radio" name="q1_3" value="cuire"> Cuire les aliments</label>
                    <label><input type="radio" name="q1_3" value="decorer"> D√©corer la cuisine</label>
                </div>
            </div>

            <!-- Exercice 2 -->
            <div class="exercise">
                <h2>Exercice 2 : Distinguer fonction d'usage et fonction d'estime</h2>
                <p>Pour chaque affirmation, indique s'il s'agit d'une fonction d'usage ou d'une fonction d'estime :</p>
                
                <div class="question">
                    <p><strong>2.1 - "Cette montre est de couleur rouge, j'adore !"</strong></p>
                    <label><input type="radio" name="q2_1" value="usage" required> Fonction d'usage</label>
                    <label><input type="radio" name="q2_1" value="estime"> Fonction d'estime</label>
                </div>

                <div class="question">
                    <p><strong>2.2 - "Cette montre me permet de conna√Ætre l'heure"</strong></p>
                    <label><input type="radio" name="q2_2" value="usage" required> Fonction d'usage</label>
                    <label><input type="radio" name="q2_2" value="estime"> Fonction d'estime</label>
                </div>

                <div class="question">
                    <p><strong>2.3 - "Ce sac √† dos est tr√®s tendance cette ann√©e"</strong></p>
                    <label><input type="radio" name="q2_3" value="usage" required> Fonction d'usage</label>
                    <label><input type="radio" name="q2_3" value="estime"> Fonction d'estime</label>
                </div>

                <div class="question">
                    <p><strong>2.4 - "Ce sac √† dos permet de transporter mes affaires scolaires"</strong></p>
                    <label><input type="radio" name="q2_4" value="usage" required> Fonction d'usage</label>
                    <label><input type="radio" name="q2_4" value="estime"> Fonction d'estime</label>
                </div>

                <div class="question">
                    <p><strong>2.5 - "Cette voiture a un design magnifique"</strong></p>
                    <label><input type="radio" name="q2_5" value="usage" required> Fonction d'usage</label>
                    <label><input type="radio" name="q2_5" value="estime"> Fonction d'estime</label>
                </div>

                <div class="question">
                    <p><strong>2.6 - "Cette voiture permet de transporter 5 personnes"</strong></p>
                    <label><input type="radio" name="q2_6" value="usage" required> Fonction d'usage</label>
                    <label><input type="radio" name="q2_6" value="estime"> Fonction d'estime</label>
                </div>
            </div>

            <!-- Exercice 3 -->
            <div class="exercise">
                <h2>Exercice 3 : Analyse personnelle</h2>
                <p>Choisis un objet technique que tu poss√®des et analyse-le :</p>
                
                <div class="question">
                    <p><strong>3.1 - Quel objet technique as-tu choisi ?</strong></p>
                    <input type="text" name="q3_1" placeholder="Ex: ma trousse, mon casque audio, ma console..." required>
                </div>

                <div class="question">
                    <p><strong>3.2 - Quelle est sa fonction d'usage ? (√Ä quoi sert-il ?)</strong></p>
                    <textarea name="q3_2" placeholder="D√©cris le service rendu par cet objet..." required></textarea>
                </div>

                <div class="question">
                    <p><strong>3.3 - Pourquoi as-tu choisi cet objet plut√¥t qu'un autre de la m√™me famille ? (Fonction d'estime)</strong></p>
                    <textarea name="q3_3" placeholder="Ex: la couleur, la marque, le design, la popularit√©..." required></textarea>
                </div>

                <div class="question">
                    <p><strong>3.4 - Donne un exemple d'un autre objet qui a la m√™me fonction d'usage :</strong></p>
                    <input type="text" name="q3_4" placeholder="Un objet de la m√™me famille..." required>
                </div>
            </div>

            <div class="button-container">
                <button type="button" id="sendToFirebase" class="btn-sheets">üì§ Envoyer au professeur</button>
            </div>
        </form>
    </div>

   <script>
    // ============================================
    // CONFIGURATION FIREBASE
    // ============================================
    const firebaseConfig = {
        apiKey: "AIzaSyDIvzEk0xKVdRC0r9D_tBGnKPX29Fqkem4",
        authDomain: "form-results-b285b.firebaseapp.com",
        projectId: "form-results-b285b",
        storageBucket: "form-results-b285b.firebasestorage.app",
        messagingSenderId: "662462446647",
        appId: "1:662462446647:web:0fe6315cc0c189185513b2"
    };

    // Initialiser Firebase (syntaxe compat)
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    console.log('Firebase initialis√© avec succ√®s');

    // ============================================
    // CONFIRMATION AVANT FERMETURE
    // ============================================
    let formModified = false;

    document.getElementById('quizForm').addEventListener('input', function() {
        formModified = true;
    });

    window.addEventListener('beforeunload', function(e) {
        if (formModified) {
            e.preventDefault();
            e.returnValue = '';
            return '';
        }
    });

    // ============================================
    // FONCTION D'ENVOI FIREBASE
    // ============================================
    async function sendToFirebase(collectionName, formData, buttonElement) {
        try {
            // D√©sactiver le bouton pendant l'envoi
            const originalText = buttonElement.textContent;
            buttonElement.disabled = true;
            buttonElement.textContent = '‚è≥ Envoi en cours...';
            
            // Ajouter un timestamp automatique
            formData.timestamp = firebase.firestore.FieldValue.serverTimestamp();
            formData.date_soumission = new Date().toISOString();
            
            // Envoyer √† Firebase
            const docRef = await db.collection(collectionName).add(formData);
            
            console.log('Document enregistr√© avec ID:', docRef.id);
            
            // R√©activer le bouton
            buttonElement.disabled = false;
            buttonElement.textContent = originalText;
            
            // Notification de succ√®s
            alert('‚úÖ Tes r√©ponses ont √©t√© envoy√©es avec succ√®s !');
            
            return true;
            
        } catch (error) {
            console.error('Erreur Firebase:', error);
            
            // R√©activer le bouton
            buttonElement.disabled = false;
            buttonElement.textContent = originalText;
            
            // Notification d'erreur d√©taill√©e
            alert('‚ùå Erreur lors de l\'envoi : ' + error.message);
            
            return false;
        }
    }
    
    // ============================================
    // BOUTON D'ENVOI
    // ============================================
    document.getElementById('sendToFirebase').addEventListener('click', async function() {
        const form = document.getElementById('quizForm');
        
        // V√©rifier la validit√© du formulaire
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }
        
        // Collecter les donn√©es du formulaire
        const formData = new FormData(form);
        
        // Pr√©parer l'objet de donn√©es
        const responses = {
            // M√©tadonn√©es
            nom_eleve: document.getElementById('studentName').value,
            classe: document.getElementById('studentClass').value,
            
            // Exercice 1
            ex1_q1: formData.get('q1_1'),
            ex1_q2: formData.get('q1_2'),
            ex1_q3: formData.get('q1_3'),
            
            // Exercice 2
            ex2_q1: formData.get('q2_1'),
            ex2_q2: formData.get('q2_2'),
            ex2_q3: formData.get('q2_3'),
            ex2_q4: formData.get('q2_4'),
            ex2_q5: formData.get('q2_5'),
            ex2_q6: formData.get('q2_6'),
            
            // Exercice 3
            ex3_objet: formData.get('q3_1'),
            ex3_fonction_usage: formData.get('q3_2'),
            ex3_fonction_estime: formData.get('q3_3'),
            ex3_meme_famille: formData.get('q3_4')
        };
        
        console.log('Donn√©es √† envoyer:', responses);
        
        // Envoyer √† Firebase
        const success = await sendToFirebase('fonction_usage_estime', responses, this);
        
        // Si succ√®s, r√©initialiser le formulaire
        if (success) {
            form.reset();
            formModified = false;
        }
    });

        // Confirmation avant fermeture de la page
        let formModified = false;

        // D√©tecter les modifications du formulaire
        document.getElementById('quizForm').addEventListener('input', function() {
            formModified = true;
        });

        // Emp√™cher la fermeture si le formulaire a √©t√© modifi√©
        window.addEventListener('beforeunload', function(e) {
            if (formModified) {
                e.preventDefault();
                e.returnValue = ''; // N√©cessaire pour Chrome
                return ''; // Pour les anciens navigateurs
            }
        });

        // R√©initialiser le flag apr√®s soumission r√©ussie
        document.getElementById('quizForm').addEventListener('submit', function(e) {
            formModified = false; // Permettre la fermeture apr√®s t√©l√©chargement
            // ... reste du code de soumission
        });
    </script>
</body>
</html>
